/* This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/. */

#include <boost/test/floating_point_comparison.hpp>
#include <boost/test/test_tools.hpp>    
#include <boost/test/unit_test.hpp>

#include "xc_kit/xc_functionals.hpp"
    
void check_becke88_x_functional()
{
    const double eps = 1e-7;
    XCFunctionalData xc;
    xc = becke88_x_functional(0.17E+01, 0.17E+01, 0.81E-11, 0.81E-11, 0.81E-11, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.377592720836E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.148075576798E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.148075576798E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.207006537839E-02, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.207006537839E-02, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.290344268232E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.290344268232E+00, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.162358068893E-02, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.162358068893E-02, eps);
    //BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.253445241319E-04, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    //BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.253445241319E-04, eps);
    xc = becke88_x_functional(0.17E+01, 0.17E+01, 0.17E+01, 0.17E+01, 0.17E+01, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.378289713911E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.147807268065E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.147807268065E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.203114756676E-02, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.203114756676E-02, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.293917869186E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.293917869186E+00, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.153738619102E-02, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.153738619102E-02, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.208765215311E-04, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.208765215311E-04, eps);
    xc = becke88_x_functional(0.15E+01, 0.15E+01, 0.36E+02, 0.36E+02, 0.36E+02, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.334570325134E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.136817307919E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.136817307919E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.185634599412E-02, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.185634599412E-02, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.371678164240E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.371678164240E+00, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.105687034683E-02, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.105687034683E-02, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.926898408248E-05, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.926898408248E-05, eps);
    xc = becke88_x_functional(0.88E-01, 0.88E-01, 0.87E-01, 0.87E-01, 0.87E-01, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.851611545044E-01, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.501899165865E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.501899165865E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.543404155466E-01, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.543404155466E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.253321231850E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.253321231850E+01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.239754146866E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.239754146866E+00, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.221360010652E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.221360010652E+00, eps);
    xc = becke88_x_functional(0.18E+04, 0.18E+04, 0.55E+00, 0.55E+00, 0.55E+00, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.407494475322E+05, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.150923879747E+02, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.150923879747E+02, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.191816494659E-06, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.191816494659E-06, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.279488666210E-02, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.279488666210E-02, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.142086292324E-09, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.142086292324E-09, eps);
    //BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.201646090402E-16, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    //BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.201646090402E-16, eps);
    xc = becke88_x_functional(0.18E+04, 0.18E+04, 0.86E+04, 0.86E+04, 0.86E+04, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.407494508312E+05, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.150923867529E+02, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.150923867529E+02, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.191816321255E-06, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.191816321255E-06, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.279488824600E-02, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.279488824600E-02, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.142085906983E-09, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.142085906983E-09, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.201644008560E-16, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.201644008560E-16, eps);
    xc = becke88_x_functional(0.16E+04, 0.16E+04, 0.37E+10, 0.37E+10, 0.37E+10, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.362648637930E+05, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.140333722784E+02, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.140333722784E+02, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.174646643568E-06, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.174646643568E-06, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.352244394438E-02, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.352244394438E-02, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.971067113036E-10, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.971067113036E-10, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.785386351399E-17, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.785386351399E-17, eps);
    xc = becke88_x_functional(0.26E+00, 0.26E+00, 0.28E+00, 0.28E+00, 0.28E+00, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.321148637763E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.766539815464E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.766539815464E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.198197408319E-01, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.198197408319E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.117949870779E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.117949870779E+01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.685130252745E-01, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.685130252745E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.115351801846E-01, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.115351801846E-01, eps);
    xc = becke88_x_functional(0.53E+05, 0.53E+05, 0.96E+05, 0.96E+05, 0.96E+05, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.370503980183E+07, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.466042742267E+02, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.466042742267E+02, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.210967131116E-08, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.210967131116E-08, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.293108643192E-03, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.293108643192E-03, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.530734919752E-13, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.530734919752E-13, eps);
    //BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.268272614874E-22, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    //BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.268272614874E-22, eps);
    xc = becke88_x_functional(0.47E+05, 0.47E+05, 0.29E+14, 0.29E+14, 0.29E+14, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.328152696735E+07, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.433514250199E+02, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.433514250199E+02, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.194182330561E-08, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.194182330561E-08, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.368694289315E-03, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.368694289315E-03, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.372175421272E-13, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.372175421272E-13, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.108604300970E-22, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.108604300970E-22, eps);
    xc = becke88_x_functional(0.15E+00, 0.15E+00, 0.16E+00, 0.16E+00, 0.16E+00, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.161367392847E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.619947650806E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.619947650806E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.341862053361E-01, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.341862053361E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.179936512300E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.179936512300E+01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.148255198864E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.148255198864E+00, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.547109233247E-01, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.547109233247E-01, eps);
    xc = becke88_x_functional(0.35E+01, 0.00E+00, 0.46E-10, 0.00E+00, 0.00E+00, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.494484233083E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.188374945936E+01, eps);
    BOOST_CHECK_SMALL(xc.de_drb, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.790360507210E-03, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_SMALL(xc.de_dgbb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.179404710416E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbrb, eps);
    //BOOST_CHECK_SMALL(xc.d2e_dragaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgbb, eps);
    //BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.141061224494E-05, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgbb, eps);
    xc = becke88_x_functional(0.35E+01, 0.00E+00, 0.34E+01, 0.00E+00, 0.00E+00, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.494752158228E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.188273473796E+01, eps);
    BOOST_CHECK_SMALL(xc.de_drb, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.785719874797E-03, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_SMALL(xc.de_dgbb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.180074584533E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbrb, eps);
    //BOOST_CHECK_SMALL(xc.d2e_dragaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgbb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.132207800833E-05, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgbb, eps);
    xc = becke88_x_functional(0.30E+01, 0.00E+00, 0.20E+03, 0.00E+00, 0.00E+00, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.419401965265E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.172996985225E+01, eps);
    BOOST_CHECK_SMALL(xc.de_drb, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.753968712720E-03, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_SMALL(xc.de_dgbb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.231847776994E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbrb, eps);
    //BOOST_CHECK_SMALL(xc.d2e_dragaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgbb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.631038474677E-06, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgbb, eps);
    xc = becke88_x_functional(0.58E-01, 0.00E+00, 0.47E-01, 0.00E+00, 0.00E+00, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.259998774808E-01, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.428541964579E+00, eps);
    BOOST_CHECK_SMALL(xc.de_drb, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.782798087404E-01, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_SMALL(xc.de_dgbb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.312635380295E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbrb, eps);
    //BOOST_CHECK_SMALL(xc.d2e_dragaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgbb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.690680500539E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgbb, eps);
    xc = becke88_x_functional(0.82E+02, 0.81E+02, 0.49E+07, 0.49E+07, 0.49E+07, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.740814331850E+03, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.498247046111E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.495532429311E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.678262141094E-05, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.682517937334E-05, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.270432929879E-01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.272490060294E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.426066228043E-07, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.425046982664E-07, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.424725929436E-12, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.432961117719E-12, eps);
    xc = becke88_x_functional(0.39E+02, 0.38E+02, 0.81E+06, 0.82E+06, 0.82E+06, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.277987329958E+03, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.385951846654E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.381309494319E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.172434478018E-04, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.173712338362E-04, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.441426807406E-01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.447245742260E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.201415922856E-06, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.195961359539E-06, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.700742719647E-11, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.718678968862E-11, eps);
    xc = becke88_x_functional(0.13E+00, 0.95E-01, 0.15E+00, 0.18E+00, 0.22E+00, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.120208982576E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.583637510333E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.501672871724E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.379227871606E-01, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.367802205908E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.199082326261E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.213690115573E+01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.160652968405E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.609908850345E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.741970758035E-01, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.737150455275E-01, eps);
    xc = becke88_x_functional(0.78E-01, 0.31E-01, 0.41E-02, 0.38E-02, 0.36E-02, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.416730804241E-01, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.522700471817E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.360524872778E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.111846105258E+00, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.249411314940E+00, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.245380935846E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.517371957290E+01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.156984506289E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.418857803825E+01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.244026452179E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.211148438264E+02, eps);
    xc = becke88_x_functional(0.50E+02, 0.49E+02, 0.11E+06, 0.11E+06, 0.11E+06, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.343037899309E+03, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.451375531283E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.448071957650E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.204625762085E-04, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.209266539812E-04, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.327661718483E-01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.333090761894E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.455875527750E-06, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.472402981076E-06, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.153056541719E-10, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.162083837575E-10, eps);
    xc = becke88_x_functional(0.40E+02, 0.40E+02, 0.99E+05, 0.98E+05, 0.98E+05, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.260133861611E+03, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.416254426190E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.416322526434E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.262815715798E-04, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.263113502629E-04, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.391759770307E-01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.391492164486E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.680016391145E-06, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.681990700893E-06, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.297024234619E-10, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.298552512045E-10, eps);
    xc = becke88_x_functional(0.12E+00, 0.10E+00, 0.12E+00, 0.13E+00, 0.14E+00, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.112603177863E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.568498809942E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.520860206545E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.423139064219E-01, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.436372569148E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.209994430549E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.229642938280E+01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.195292854203E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.150061257405E+00, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.103073123098E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.115652366462E+00, eps);
    xc = becke88_x_functional(0.48E-01, 0.25E-01, 0.46E-02, 0.44E-02, 0.41E-02, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.253983617946E-01, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.431645138108E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.325991019475E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.175455092294E+00, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.260075409570E+00, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.374315005133E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.566470285703E+01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.291762144791E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.301407606104E+01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.765442610536E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.248245711494E+02, eps);
}

