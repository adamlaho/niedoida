/* This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/. */

#include <boost/test/floating_point_comparison.hpp>
#include <boost/test/test_tools.hpp>    
#include <boost/test/unit_test.hpp>

#include "xc_kit/xc_functionals.hpp"
    
void check_pbe_x_functional()
{
    const double eps = 1e-7;
    XCFunctionalData xc;
    xc = pbe_x_functional(0.17E+01, 0.17E+01, 0.81E-11, 0.81E-11, 0.81E-11, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.377592720836E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.148075576798E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.148075576798E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.165665974842E-02, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.165665974842E-02, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.290344268232E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.290344268232E+00, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.129934097915E-02, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.129934097915E-02, eps);
    //BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.361615443758E-05, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    //BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.361615443758E-05, eps);
    xc = pbe_x_functional(0.17E+01, 0.17E+01, 0.17E+01, 0.17E+01, 0.17E+01, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.378154942017E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.147855914532E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.147855914532E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.165052935245E-02, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.165052935245E-02, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.293340073168E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.293340073168E+00, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.128494322308E-02, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.128494322308E-02, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.359610088925E-05, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.359610088925E-05, eps);
    xc = pbe_x_functional(0.15E+01, 0.15E+01, 0.36E+02, 0.36E+02, 0.36E+02, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.332917118617E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.136704102604E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.136704102604E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.175922831660E-02, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.175922831660E-02, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.383048644703E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.383048644703E+00, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.123846484420E-02, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.123846484420E-02, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.508271342885E-05, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.508271342885E-05, eps);
    xc = pbe_x_functional(0.88E-01, 0.88E-01, 0.87E-01, 0.87E-01, 0.87E-01, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.847500738867E-01, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.498335317577E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.498335317577E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.545109539268E-01, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.545109539268E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.229469146464E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.229469146464E+01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.154401191219E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.154401191219E+00, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.254715375324E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.254715375324E+00, eps);
    xc = pbe_x_functional(0.18E+04, 0.18E+04, 0.55E+00, 0.55E+00, 0.55E+00, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.407494475322E+05, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.150923879748E+02, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.150923879748E+02, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.153509482897E-06, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.153509482897E-06, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.279488666208E-02, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.279488666208E-02, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.113710728070E-09, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.113710728070E-09, eps);
    //BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.287708461721E-17, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    //BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.287708461721E-17, eps);
    xc = pbe_x_functional(0.18E+04, 0.18E+04, 0.86E+04, 0.86E+04, 0.86E+04, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.407494501724E+05, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.150923869969E+02, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.150923869969E+02, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.153509458156E-06, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.153509458156E-06, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.279488792967E-02, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.279488792967E-02, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.113710673089E-09, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.113710673089E-09, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.287708392165E-17, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.287708392165E-17, eps);
    xc = pbe_x_functional(0.16E+04, 0.16E+04, 0.37E+10, 0.37E+10, 0.37E+10, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.360960910073E+05, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.140305340798E+02, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.140305340798E+02, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.163703325386E-06, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.163703325386E-06, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.361179088671E-02, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.361179088671E-02, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.111691289742E-09, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.111691289742E-09, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.400996995891E-17, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.400996995891E-17, eps);
    xc = pbe_x_functional(0.26E+00, 0.26E+00, 0.28E+00, 0.28E+00, 0.28E+00, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.319679717401E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.766494428708E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.766494428708E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.185240091115E-01, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.185240091115E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.120781973536E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.120781973536E+01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.783950736036E-01, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.783950736036E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.578030314073E-02, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.578030314073E-02, eps);
    xc = pbe_x_functional(0.53E+05, 0.53E+05, 0.96E+05, 0.96E+05, 0.96E+05, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.370503980175E+07, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.466042742277E+02, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.466042742277E+02, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.168835611841E-08, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.168835611841E-08, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.293108643147E-03, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.293108643147E-03, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.424743677402E-13, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.424743677402E-13, eps);
    //BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.382771132308E-23, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    //BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.382771132308E-23, eps);
    xc = pbe_x_functional(0.47E+05, 0.47E+05, 0.29E+14, 0.29E+14, 0.29E+14, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.326657718168E+07, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.433502031071E+02, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.433502031071E+02, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.181368847096E-08, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.181368847096E-08, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.377435398713E-03, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.377435398713E-03, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.425352935840E-13, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.425352935840E-13, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.541929951945E-23, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.541929951945E-23, eps);
    xc = pbe_x_functional(0.15E+00, 0.15E+00, 0.16E+00, 0.16E+00, 0.16E+00, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.160448304498E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.616293740752E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.616293740752E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.340347075448E-01, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.340347075448E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.188013619179E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.188013619179E+01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.179505894965E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.179505894965E+00, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.432509198788E-01, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.432509198788E-01, eps);
    xc = pbe_x_functional(0.35E+01, 0.00E+00, 0.46E-10, 0.00E+00, 0.00E+00, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.494484233083E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.188374945936E+01, eps);
    BOOST_CHECK_SMALL(xc.de_drb, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.632520331341E-03, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_SMALL(xc.de_dgbb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.179404710416E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbrb, eps);
    //BOOST_CHECK_SMALL(xc.d2e_dragaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgbb, eps);
    //BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.201266029008E-06, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgbb, eps);
    xc = pbe_x_functional(0.35E+01, 0.00E+00, 0.34E+01, 0.00E+00, 0.00E+00, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.494699173727E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.188293152324E+01, eps);
    BOOST_CHECK_SMALL(xc.de_drb, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.631836581688E-03, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_SMALL(xc.de_dgbb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.179948990030E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbrb, eps);
    //BOOST_CHECK_SMALL(xc.d2e_dragaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgbb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.200939766657E-06, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgbb, eps);
    xc = pbe_x_functional(0.30E+01, 0.00E+00, 0.20E+03, 0.00E+00, 0.00E+00, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.417440506676E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.172954529118E+01, eps);
    BOOST_CHECK_SMALL(xc.de_drb, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.707320404038E-03, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_SMALL(xc.de_dgbb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.237820356120E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbrb, eps);
    //BOOST_CHECK_SMALL(xc.d2e_dragaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgbb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.323948969032E-06, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgbb, eps);
    xc = pbe_x_functional(0.58E-01, 0.00E+00, 0.47E-01, 0.00E+00, 0.00E+00, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.258503716227E-01, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.433574571158E+00, eps);
    BOOST_CHECK_SMALL(xc.de_drb, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.743604018862E-01, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_SMALL(xc.de_dgbb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.182332674956E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbrb, eps);
    //BOOST_CHECK_SMALL(xc.d2e_dragaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgbb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.934224897782E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgbb, eps);
    xc = pbe_x_functional(0.82E+02, 0.81E+02, 0.49E+07, 0.49E+07, 0.49E+07, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.736865469611E+03, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.493897932478E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.491161504563E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.685185279408E-05, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.689688466662E-05, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.273332629968E-01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.273922219983E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.455358003173E-07, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.445075229580E-07, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.413408272915E-12, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.427862514991E-12, eps);
    xc = pbe_x_functional(0.39E+02, 0.38E+02, 0.81E+06, 0.82E+06, 0.82E+06, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.276589791995E+03, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.382556082420E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.378108116179E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.174145337536E-04, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.175120610339E-04, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.429564214817E-01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.424802511645E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.185237729809E-06, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.161839553501E-06, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.740514207206E-11, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.786563034093E-11, eps);
    xc = pbe_x_functional(0.13E+00, 0.95E-01, 0.15E+00, 0.18E+00, 0.22E+00, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.119421209325E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.578832621965E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.517389121001E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.382340404759E-01, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.332973674309E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.204167554105E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.722156009564E+00, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.181184032538E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, -0.177031055838E+00, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.685619910117E-01, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.104342795817E+00, eps);
    xc = pbe_x_functional(0.78E-01, 0.31E-01, 0.41E-02, 0.38E-02, 0.36E-02, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.415413960050E-01, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.523382772310E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.357399049244E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.975929514687E-01, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.251904684435E+00, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.245525965200E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.524279284728E+01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.155938982496E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.452016269281E+01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.776664232752E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.203904030316E+02, eps);
    xc = pbe_x_functional(0.50E+02, 0.49E+02, 0.11E+06, 0.11E+06, 0.11E+06, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.342262372442E+03, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.451953851009E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.448651692914E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.177274055848E-04, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.181825088154E-04, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.327443513253E-01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.333030095027E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.445584305337E-06, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.464801667902E-06, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.462724606680E-11, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.500476145449E-11, eps);
    xc = pbe_x_functional(0.40E+02, 0.40E+02, 0.99E+05, 0.98E+05, 0.98E+05, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.259316875633E+03, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.416761407365E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.416832346828E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.234431309174E-04, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.234541298631E-04, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.394086605352E-01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.393741681091E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.708870190119E-06, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.709919266338E-06, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.109950768377E-10, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.110028156783E-10, eps);
    xc = pbe_x_functional(0.12E+00, 0.10E+00, 0.12E+00, 0.13E+00, 0.14E+00, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.112021068338E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.563849973546E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.518540640509E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.426508442574E-01, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.433850716387E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.215582132758E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.193599570809E+01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.221089275399E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.555875642118E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.948033727977E-01, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.140057158296E+00, eps);
    xc = pbe_x_functional(0.48E-01, 0.25E-01, 0.46E-02, 0.44E-02, 0.41E-02, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.252665336863E-01, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.430778167566E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.326346959743E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.168954851377E+00, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.254284088546E+00, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.388578815717E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.420071526691E+01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.349932953984E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, -0.344308375753E+00, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.467162912424E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.317975451941E+02, eps);
}

