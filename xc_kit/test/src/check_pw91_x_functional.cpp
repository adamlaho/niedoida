/* This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/. */

#include <boost/test/floating_point_comparison.hpp>
#include <boost/test/test_tools.hpp>    
#include <boost/test/unit_test.hpp>

#include "xc_kit/xc_functionals.hpp"
    
void check_pw91_x_functional()
{
    const double eps = 1e-7;
    XCFunctionalData xc;
    xc = pw91_x_functional(0.17E+01, 0.17E+01, 0.81E-11, 0.81E-11, 0.81E-11, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.377592720836E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.148075576798E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.148075576798E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.932043387995E-03, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.932043387995E-03, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.290344268232E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.290344268232E+00, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.731014421969E-03, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.731014421969E-03, eps);
    // Relative accuracy at the level of 1e-4%
    //BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, -0.898210267526E-03, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    // Relative accuracy at the level of 1e-4%
    //BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, -0.898210267526E-03, eps);
    xc = pw91_x_functional(0.17E+01, 0.17E+01, 0.17E+01, 0.17E+01, 0.17E+01, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.378095444846E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.147778591928E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.147778591928E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.185299327723E-02, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.185299327723E-02, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.295642969077E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.295642969077E+00, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.220538404493E-02, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.220538404493E-02, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, -0.282020994133E-03, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, -0.282020994133E-03, eps);
    xc = pw91_x_functional(0.15E+01, 0.15E+01, 0.36E+02, 0.36E+02, 0.36E+02, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.334524619161E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.136875736984E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.136875736984E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.184404242682E-02, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.184404242682E-02, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.369823738710E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.369823738710E+00, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.102586616094E-02, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.102586616094E-02, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.958254160782E-05, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.958254160782E-05, eps);
    xc = pw91_x_functional(0.88E-01, 0.88E-01, 0.87E-01, 0.87E-01, 0.87E-01, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.849656692562E-01, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.505975525936E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.505975525936E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.522324707834E-01, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.522324707834E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.232075764416E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.232075764416E+01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.153311051900E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.153311051900E+00, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.242034145736E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.242034145736E+00, eps);
    xc = pw91_x_functional(0.18E+04, 0.18E+04, 0.55E+00, 0.55E+00, 0.55E+00, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.407494475321E+05, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.150923879748E+02, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.150923879748E+02, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.863650482950E-07, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.863650482950E-07, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.279488666205E-02, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.279488666205E-02, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.639741104304E-10, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.639741104304E-10, eps);
    // Relative accuracy at the level of 5e-7%
    //BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, -0.714634007138E-15, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    // Relative accuracy at the level of 5e-7%
    //BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, -0.714634007138E-15, eps);
    xc = pw91_x_functional(0.18E+04, 0.18E+04, 0.86E+04, 0.86E+04, 0.86E+04, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.407494490175E+05, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.150923874246E+02, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.150923874246E+02, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.863711936127E-07, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.863711936127E-07, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.279488737536E-02, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.279488737536E-02, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.639877664823E-10, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.639877664823E-10, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, -0.714601070507E-15, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, -0.714601070507E-15, eps);
    xc = pw91_x_functional(0.16E+04, 0.16E+04, 0.37E+10, 0.37E+10, 0.37E+10, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.362611022960E+05, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.140378983689E+02, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.140378983689E+02, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.173658527748E-06, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.173658527748E-06, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.350892583997E-02, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.350892583997E-02, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.947616778029E-10, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.947616778029E-10, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.810061005198E-17, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.810061005198E-17, eps);
    xc = pw91_x_functional(0.26E+00, 0.26E+00, 0.28E+00, 0.28E+00, 0.28E+00, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.321117679152E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.766769287958E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.766769287958E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.197121936150E-01, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.197121936150E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.117527513839E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.117527513839E+01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.669398749951E-01, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.669398749951E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.118909249839E-01, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.118909249839E-01, eps);
    xc = pw91_x_functional(0.53E+05, 0.53E+05, 0.96E+05, 0.96E+05, 0.96E+05, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.370503980161E+07, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.466042742295E+02, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.466042742295E+02, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.949875983759E-09, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.949875983759E-09, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.293108643068E-03, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.293108643068E-03, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.238962557561E-13, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.238962557561E-13, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, -0.950758452942E-21, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, -0.950758452942E-21, eps);
    xc = pw91_x_functional(0.47E+05, 0.47E+05, 0.29E+14, 0.29E+14, 0.29E+14, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.328121581863E+07, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.433641861522E+02, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.433641861522E+02, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.193138530087E-08, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.193138530087E-08, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.367394498371E-03, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.367394498371E-03, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.363725780955E-13, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.363725780955E-13, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.111939986725E-22, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.111939986725E-22, eps);
    xc = pw91_x_functional(0.15E+00, 0.15E+00, 0.16E+00, 0.16E+00, 0.16E+00, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.161281959179E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.621017974954E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.621017974954E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.336764293971E-01, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.336764293971E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.176594570925E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.176594570925E+01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.135669995475E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.135669995475E+00, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.575423590814E-01, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.575423590814E-01, eps);
    xc = pw91_x_functional(0.35E+01, 0.00E+00, 0.46E-10, 0.00E+00, 0.00E+00, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.494484233083E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.188374945936E+01, eps);
    BOOST_CHECK_SMALL(xc.de_drb, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.355858463490E-03, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_SMALL(xc.de_dgbb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.179404710416E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbrb, eps);
    // The result from DFR is incorrect
    //BOOST_CHECK_SMALL(xc.d2e_dragaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgbb, eps);
    // Relative accuracy at the level of 5e-4%
    //BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, -0.499921164542E-04, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgbb, eps);
    xc = pw91_x_functional(0.35E+01, 0.00E+00, 0.34E+01, 0.00E+00, 0.00E+00, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.494631332487E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.188301001743E+01, eps);
    BOOST_CHECK_SMALL(xc.de_drb, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.501768985932E-03, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_SMALL(xc.de_dgbb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.180074077999E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbrb, eps);
    // The result from DFR is incorrect
    //BOOST_CHECK_SMALL(xc.d2e_dragaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgbb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, -0.364530853359E-04, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgbb, eps);
    xc = pw91_x_functional(0.30E+01, 0.00E+00, 0.20E+03, 0.00E+00, 0.00E+00, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.419357531760E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.173053997913E+01, eps);
    BOOST_CHECK_SMALL(xc.de_drb, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.749650911390E-03, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_SMALL(xc.de_dgbb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.230939937528E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbrb, eps);
    // The result from DFR is incorrect
    //BOOST_CHECK_SMALL(xc.d2e_dragaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgbb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.650972931765E-06, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgbb, eps);
    xc = pw91_x_functional(0.58E-01, 0.00E+00, 0.47E-01, 0.00E+00, 0.00E+00, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.258584951104E-01, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.437338372420E+00, eps);
    BOOST_CHECK_SMALL(xc.de_drb, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.727050628737E-01, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_SMALL(xc.de_dgbb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.244260746620E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbrb, eps);
    // The result from DFR is incorrect
    //BOOST_CHECK_SMALL(xc.d2e_dragaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgbb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.788626837062E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgbb, eps);
    xc = pw91_x_functional(0.82E+02, 0.81E+02, 0.49E+07, 0.49E+07, 0.49E+07, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.739934270280E+03, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.500194130392E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.497593413511E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.661655297347E-05, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.665149614704E-05, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.259426653786E-01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.260706018375E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.352029178373E-07, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.346740334540E-07, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.454242196579E-12, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.463780470889E-12, eps);
    xc = pw91_x_functional(0.39E+02, 0.38E+02, 0.81E+06, 0.82E+06, 0.82E+06, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.277508827319E+03, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.388082848748E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.383766691652E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.167197684376E-04, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.167896719939E-04, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.416220420890E-01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.417483248081E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.152615808168E-06, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.140494224330E-06, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.756528151156E-11, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.779608939054E-11, eps);
    xc = pw91_x_functional(0.13E+00, 0.95E-01, 0.15E+00, 0.18E+00, 0.22E+00, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.119728770337E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.585486559894E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.517319511766E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.371067307505E-01, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.333018097938E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.192471177532E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.140195266234E+01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.137625860400E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, -0.669107971583E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.789606978716E-01, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.865209183894E-01, eps);
    xc = pw91_x_functional(0.78E-01, 0.31E-01, 0.41E-02, 0.38E-02, 0.36E-02, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.416606610942E-01, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.522604353726E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.361889021397E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.112405560440E+00, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.243425146968E+00, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.243569484671E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.496966001653E+01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.144354391474E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.348226944932E+01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.340954163757E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.225642197599E+02, eps);
    xc = pw91_x_functional(0.50E+02, 0.49E+02, 0.11E+06, 0.11E+06, 0.11E+06, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.343023093496E+03, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.451226856998E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.447953235217E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.206793144210E-04, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.210943591227E-04, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.324555796871E-01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.330212301202E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.404623162590E-06, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.425668722158E-06, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.250270264720E-10, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.247774253789E-10, eps);
    xc = pw91_x_functional(0.40E+02, 0.40E+02, 0.99E+05, 0.98E+05, 0.98E+05, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.260126309305E+03, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.416275280459E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.416341719698E+01, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.262307773024E-04, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.262628334268E-04, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.390699445174E-01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.390404185225E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.663687547341E-06, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.665093145052E-06, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.319199539502E-10, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.321940769142E-10, eps);
    xc = pw91_x_functional(0.12E+00, 0.10E+00, 0.12E+00, 0.13E+00, 0.14E+00, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.112397017484E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.570266857493E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.526312948559E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.414136182087E-01, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.416437885637E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.203144459871E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.204737952263E+01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.167763747962E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.784829537759E-01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.109645337051E+00, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.127705596537E+00, eps);
    xc = pw91_x_functional(0.48E-01, 0.25E-01, 0.46E-02, 0.44E-02, 0.41E-02, 2);
    BOOST_CHECK_CLOSE(xc.e, -0.253628097987E-01, eps);
    BOOST_CHECK_CLOSE(xc.de_dra, -0.431923798174E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_drb, -0.330648852409E+00, eps);
    BOOST_CHECK_CLOSE(xc.de_dgaa, -0.173983322535E+00, eps);
    BOOST_CHECK_SMALL(xc.de_dgab, eps);
    BOOST_CHECK_CLOSE(xc.de_dgbb, -0.245517135909E+00, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drara, -0.371564332659E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_drarb, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbrb, -0.481847641292E+01, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dragaa, 0.280241415366E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dragbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgaa, eps);
    BOOST_CHECK_SMALL(xc.d2e_drbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_drbgbb, 0.937099956078E+00, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgaagaa, 0.794526228298E+01, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgaagbb, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgabgab, eps);
    BOOST_CHECK_SMALL(xc.d2e_dgbbgab, eps);
    BOOST_CHECK_CLOSE(xc.d2e_dgbbgbb, 0.277983550893E+02, eps);
}

